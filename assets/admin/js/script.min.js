"use strict";!function(r){var s={},e={onReady:function(){this.setupDOM(),this.eventListeners(),this.initializeDependencies()},setupDOM:function(){s.changeSelectType=r(".zvc-hacking-select"),s.dateTimePicker=r("#datetimepicker"),s.goToAccordionEl=r(".vczapi-go-to-open-accordion"),s.reportsDatePicker=r("#reports_date"),s.zoomAccountDatepicker=r(".zoom_account_datepicker"),s.meetingListDTable=r("#zvc_users_list_table, #zvc_meetings_list_table"),s.meetingListTableCheck=r("#zvc_meetings_list_table"),s.usersListTable=r("#vczapi-get-host-users-wp"),s.meetingListTbl=s.meetingListTableCheck.find("input[type=checkbox]"),s.cover=r("#zvc-cover"),s.changeMeetingState=r(".vczapi-meeting-state-change"),s.show_on_meeting_delete_error=r(".show_on_meeting_delete_error"),s.toggleTriggerElement=r(".vczapi-toggle-trigger"),this.$manualHostID=r(".vczapi-admin-hostID-manually-add"),s.accordionElement=r(".vczapi-admin-accordion")},eventListeners:function(){s.toggleTriggerElement.on("click",this.togglePasswordText.bind(this)),s.accordionElement.on("click",".vczapi-admin-accordion--header",this.toggleAccordion.bind(this)),s.goToAccordionEl.on("click",this.expandAccordion.bind(this)),s.meetingListTableCheck.find("#checkall").on("click",this.meetingListTableCheck),r("#bulk_delete_meeting_listings").on("click",this.bulkDeleteMeetings),r(".zvc-meetings-form").find('input[name="password"]').on("keypress",this.meetingPassword),r(".delete-meeting").on("click",this.deleteMetting),r(".zvc-dismiss-message").on("click",this.dismissNotice.bind(this)),r(".check-api-connection").on("click",this.checkConnection.bind(this)),r(s.changeMeetingState).on("click",this.meetingStateChange.bind(this)),this.$manualHostID.on("click",this.showManualHostIDField.bind(this))},expandAccordion:function(e){e.preventDefault();e=r(e.currentTarget),e=r(e.attr("href"));void 0!==e&&0<e.length&&(e.addClass("expanded"),r("html,body").animate({scrollTop:e.offset().top},1e3),e.focus())},toggleAccordion:function(e){e.preventDefault(),r(e.currentTarget).parent().toggleClass("expanded")},togglePasswordText:function(e){e.preventDefault();var t=r(e.currentTarget),e=r(t.data("element"));0===t.data("visible")?(e.attr("type","text"),t.data("visible",1),t.text("Hide")):(e.attr("type","password"),t.data("visible",0),t.text("Show"))},showManualHostIDField:function(e){e.preventDefault(),r(".vczapi-admin-post-type-host-selector").select2("destroy").remove(),r(".vczapi-manually-hostid-wrap").before('<input type="text" placeholder="'+zvc_ajax.lang.host_id_search+'" class="regular-text vczapi-search-host-id" name="userId" required>').remove()},datePickers:function(){var e,t,i,a;0<s.dateTimePicker.length&&(t=(e=new Date).getMonth()+1,i=e.getDate(),a=e.getHours()+":"+e.getMinutes()+":"+e.getSeconds(),i=e.getFullYear()+"-"+(t<10?"0":"")+t+"-"+(i<10?"0":"")+i+" "+a,(a=s.dateTimePicker.data("existingdate"))&&(i=a),s.dateTimePicker.datetimepicker({value:i,step:15,minDate:0,format:"Y-m-d H:i"})),0<s.reportsDatePicker.length&&s.reportsDatePicker.datepicker({changeMonth:!0,changeYear:!1,showButtonPanel:!0,dateFormat:"MM yy"}).focus(function(){var i=r(this);r(".ui-datepicker-calendar").detach(),r(".ui-datepicker-close").click(function(){var e=r("#ui-datepicker-div .ui-datepicker-month :selected").val(),t=r("#ui-datepicker-div .ui-datepicker-year").html();i.datepicker("setDate",new Date(t,e,1))})}),0<r("#vczapi-check-recording-date").length&&r("#vczapi-check-recording-date").datepicker({changeMonth:!0,changeYear:!0,showButtonPanel:!0,dateFormat:"MM yy",beforeShow:function(e,t){setTimeout(function(){t.dpDiv.css({top:r("#vczapi-check-recording-date").offset().top+35,left:r("#vczapi-check-recording-date").offset().left})},0)}}).focus(function(){var i=r(this);r(".ui-datepicker-calendar").detach(),r(".ui-datepicker-close").click(function(){var e=r("#ui-datepicker-div .ui-datepicker-month :selected").val(),t=r("#ui-datepicker-div .ui-datepicker-year :selected").val();i.datepicker("setDate",new Date(t,e,1))})}),0<s.zoomAccountDatepicker.length&&s.zoomAccountDatepicker.datepicker({dateFormat:"yy-mm-dd"})},initializeDependencies:function(){0<s.changeSelectType.length&&s.changeSelectType.select2(),this.datePickers(),0<s.meetingListDTable.length&&s.meetingListDTable.dataTable({pageLength:25,columnDefs:[{targets:0,orderable:!1}]}),0<s.usersListTable.length&&s.usersListTable.dataTable({pageLength:25,columnDefs:[{targets:0,orderable:!0}],ajax:{url:ajaxurl+"?action=get_assign_host_id"},columns:[{data:"id"},{data:"email"},{data:"name"},{data:"host_id"}]}),0<r("#vczapi-select-wp-user-for-host").length&&r("#vczapi-select-wp-user-for-host").select2({ajax:{url:ajaxurl+"?action=vczapi_get_wp_users",type:"GET",dataType:"json"},placeholder:"Select a WordPress User",width:"300px"})},meetingListTableCheck:function(){r(this).is(":checked")?s.meetingListTbl.each(function(){r(this).prop("checked",!0)}):s.meetingListTbl.each(function(){r(this).prop("checked",!1)})},bulkDeleteMeetings:function(){if(1!=confirm("Confirm bulk delete these Meeting?"))return!1;var e=[];s.meetingListTableCheck.find("input.checkthis").each(function(){r(this).is(":checked")&&e.push(r(this).val())});var t=r(this).data("type");e&&(t={meetings_id:e,type:t,action:"zvc_bulk_meetings_delete",security:zvc_ajax.zvc_security},s.cover.show(),r.post(zvc_ajax.ajaxurl,t).done(function(e){s.cover.fadeOut("slow"),1==e.error?s.show_on_meeting_delete_error.show().html("<p>"+e.msg+"</p>"):(s.show_on_meeting_delete_error.show().html("<p>"+e.msg+"</p>"),location.reload())}))},meetingPassword:function(e){if(!/([a-zA-Z0-9])+/.test(String.fromCharCode(e.which)))return!1;var t=r(this).val(),e=r(this).data("maxlength");0<e&&r(this).val(t.substr(0,e))},deleteMetting:function(){var e=r(this).data("meetingid"),t=r(this).data("type");if(1!=confirm("Confirm Delete this Meeting?"))return!1;t={meeting_id:e,type:t,action:"zvc_delete_meeting",security:zvc_ajax.zvc_security};s.cover.show(),r.post(zvc_ajax.ajaxurl,t).done(function(e){s.cover.fadeOut("slow"),1==e.error?s.show_on_meeting_delete_error.show().html("<p>"+e.msg+"</p>"):(s.show_on_meeting_delete_error.show().html("<p>"+e.msg+"</p>"),location.reload())})},dismissNotice:function(e){e.preventDefault(),r(e.currentTarget).closest(".notice-success").hide(),r.post(zvc_ajax.ajaxurl,{action:"zoom_dimiss_notice"}).done(function(e){console.log(e)})},checkConnection:function(e){e.preventDefault(),s.cover.show(),r.post(zvc_ajax.ajaxurl,{action:"check_connection",security:zvc_ajax.zvc_security}).done(function(e){s.cover.hide(),alert(e)})},meetingStateChange:function(e){e.preventDefault();var t=r(e.currentTarget).data("state"),i=r(e.currentTarget).data("postid"),i={id:r(e.currentTarget).data("id"),state:t,type:r(e.currentTarget).data("type"),post_id:i||!1,action:"state_change",accss:zvc_ajax.zvc_security};("resume"===t||"end"===t&&confirm(zvc_ajax.lang.confirm_end))&&this.changeState(i)},changeState:function(e){r.post(zvc_ajax.ajaxurl,e).done(function(e){location.reload()})}},n={init:function(){this.cacheDOM(),this.evntHandlers()},cacheDOM:function(){this.notificationWrapper=r(".vczapi-status-notification"),this.syncUserId=r(".vczapi-sync-user-id")},evntHandlers:function(){this.syncUserId.on("change",this.fetchMeetingsByUser.bind(this))},fetchMeetingsByUser:function(e){e.preventDefault();var t=this,a=r(this.syncUserId).val(),e={user_id:a,action:"vczapi_sync_user",type:"check"},s=r(".results");s.html("<p>"+vczapi_sync_i10n.before_sync+"</p>"),r.post(ajaxurl,e).done(function(e){var i;e.success?(i='<div class="vczapi-sync-details">',i+="<p><strong>"+vczapi_sync_i10n.total_records_found+":</strong> "+e.data.total_records+"</p>",i+="<p><strong>"+vczapi_sync_i10n.total_not_synced_records+":</strong> "+_.size(e.data.meetings)+" (Only listing Scheduled Meetings)</p>",i+='<select class="vczapi-choose-meetings-to-sync-select2" name="sync-meeting-ids[]" multiple="multiple">',r(e.data.meetings).each(function(e,t){i+='<option value="'+t.id+'">'+t.topic+"</option>"}),i+="</select>",setTimeout(function(){r(".vczapi-choose-meetings-to-sync-select2").select2({maximumSelectionLength:10,placeholder:vczapi_sync_i10n.select2_placeholder})},100),i+='<p><a href="javascript:void(0);" class="vczapi-sync-meeting button button-primary" data-userid="'+a+'">'+vczapi_sync_i10n.sync_btn+"</a></p>",i+="</div>",s.html(i),r(".vczapi-sync-meeting").on("click",t.syncMeeting.bind(t))):s.html("<p>"+e.data+"</p>")})},syncMeeting:function(e){e.preventDefault(),r(e.currentTarget).attr("disabled","disabled");var t=r(".vczapi-choose-meetings-to-sync-select2").val();0<_.size(t)?(this.notificationWrapper.show().html("<p>"+vczapi_sync_i10n.sync_start+"</p>").removeClass("vczapi-error"),this.doSync(0,t)):(this.notificationWrapper.show().html("<p>"+vczapi_sync_i10n.sync_error+"</p>").addClass("vczapi-error"),r(e.currentTarget).removeAttr("disabled"))},doSync:function(t,i){var a=this,e={action:"vczapi_sync_user",type:"sync",meeting_id:i[t]};r.post(ajaxurl,e).done(function(e){t++,a.notificationWrapper.show().append("<p> "+e.data.msg+"</p>"),t<_.size(i)?n.doSync(t,i):(e.success?a.notificationWrapper.show().append("<p>"+vczapi_sync_i10n.sync_completed+"</p>"):a.notificationWrapper.show().append("<p>"+e.data.msg+"</p>"),r(".vczapi-sync-meeting").removeAttr("disabled"))})}},t={init:function(){this.cacheDOM(),this.evntHandlers()},cacheDOM:function(){this.meetingSelector=r("#vczapi-admin-meeting-ype"),this.hideOnWebinarSelector=r(".vczapi-admin-hide-on-webinar"),this.showOnWebinarSelector=r(".vczapi-admin-show-on-webinar")},evntHandlers:function(){this.meetingSelector.on("change",this.webinarElementsShow.bind(this))},webinarElementsShow:function(e){"2"===r(e.currentTarget).val()?(this.hideOnWebinarSelector.hide(),this.showOnWebinarSelector.show()):(this.hideOnWebinarSelector.show(),this.showOnWebinarSelector.hide())}},i={init:function(){this.cacheDOM(),void 0!==this.$wizardWrapper&&0<this.$wizardWrapper.length&&this.eventListeners()},cacheDOM:function(){this.$wizardOverlay=r(".vczapi-migrate-to-s2sOauth--overlay"),this.$wizardWrapper=r(".vczapi-migrate-to-s2sOauth"),this.$s2sOauthForm=r("#vczapi-s2sOauthCredentials-wizard-form"),this.$appSDKForm=r("#vczapi-s2soauth-app-sdk-form"),this.$messageWrapper=this.$wizardWrapper.find(".vczapi-migrate-to-s2sOauth--message")},eventListeners:function(){this.maybeTriggerMigrationWizard(),this.$wizardWrapper.find(".next-step").on("click",this.navigateToStep.bind(this)),this.$s2sOauthForm.on("submit",this.s2sOauthFormHandler.bind(this)),this.$appSDKForm.on("submit",this.appSDKFormHandler.bind(this)),r("body").on("click",this.maybeCloseWizard.bind(this))},maybeCloseWizard:function(e){e=e.target;r(e)[0]===this.$wizardOverlay[0]&&this.$wizardOverlay.removeClass("expanded")},showMessage:function(e,t){t=1<arguments.length&&void 0!==t?t:"text",e="show-message "+("success"===e?"success-message":"error-message");this.$wizardWrapper.find(".vczapi-migrate-to-s2sOauth--message").removeClass(["error-message","success-message"]),this.$wizardWrapper.find(".vczapi-migrate-to-s2sOauth--message").addClass(e).text(t)},s2sOauthFormHandler:function(e){e.preventDefault();e=r(e.target).serialize();r.ajax({type:"POST",url:ajaxurl+"?action=vczapi_save_oauth_credentials",context:this,data:e,beforeSend:function(){this.$s2sOauthForm.find("input").prop("disabled",!0),this.$s2sOauthForm.addClass("submitting")},success:function(e){this.$s2sOauthForm.find("input").prop("disabled",!1),this.$s2sOauthForm.removeClass("submitting"),e.hasOwnProperty("success")&&e.success?(this.showMessage("success",null==e?void 0:e.data.message),this.$wizardWrapper.find(".next-step").attr("disabled",!1)):this.showMessage("error",null==e?void 0:e.data.message)},error:function(e,t,i){console.log("Error thrown",i)}})},appSDKFormHandler:function(e){e.preventDefault();e=r(e.target).serialize();r.ajax({type:"POST",url:ajaxurl+"?action=vczapi_save_app_sdk_credentials",context:this,data:e,beforeSend:function(){this.$appSDKForm.find("input").prop("disabled",!0),this.$appSDKForm.addClass("submitting")},success:function(e){this.$appSDKForm.find("input").prop("disabled",!1),this.$appSDKForm.removeClass("submitting"),e.hasOwnProperty("success")&&e.success?(this.showMessage("success",null==e?void 0:e.data.message),this.$wizardWrapper.find(".next-step").attr("disabled",!1)):this.showMessage("error",null==e?void 0:e.data.message)},error:function(e,t,i){console.log("Error thrown",i)}})},maybeTriggerMigrationWizard:function(){var e=this.getSearchParameters();e.hasOwnProperty("page")&&"zoom-video-conferencing-settings"===e.page&&e.hasOwnProperty("migrate")&&"now"===e.migrate&&this.$wizardOverlay.addClass("expanded")},getSearchParameters:function(){var e=window.location.search.substring(1);return null!=e&&""!==e?this.transformToAssocArray(e):{}},transformToAssocArray:function(e){for(var t={},i=e.split("&"),a=0;a<i.length;a++){var s=i[a].split("=");t[s[0]]=s[1]}return t},navigateToStep:function(e){e.preventDefault();var t,i,a,s=r(e.currentTarget),e=s.data("step"),n=s.data("final_step");void 0===e?console.log("Error no steps defined"):0<(i=(t=this).$wizardWrapper.find(".step-"+e)).length?(a=parseInt(e)+1,this.$wizardWrapper.find(".step.active").removeClass("active").fadeOut("slow",function(){i.addClass("active").fadeIn("slow"),s.data("step",a),s.attr("disabled",!0),a>parseInt(n)&&s.hide(),t.$messageWrapper.removeClass("show-message")})):s.hide()}};r(function(){i.init(),e.onReady(),n.init(),t.init()})}(jQuery);